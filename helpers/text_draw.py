# helpers/text_draw.py

FONT_5X7 = {
    'A': [0x1E, 0x05, 0x05, 0x1E, 0x00],
    'B': [0x1F, 0x15, 0x15, 0x0A, 0x00],
    'C': [0x0E, 0x11, 0x11, 0x0A, 0x00],
    'D': [0x1F, 0x11, 0x11, 0x0E, 0x00],
    'E': [0x1F, 0x15, 0x15, 0x11, 0x00],
    'F': [0x1F, 0x05, 0x05, 0x01, 0x00],
    'G': [0x0E, 0x11, 0x15, 0x1D, 0x00],
    'H': [0x1F, 0x04, 0x04, 0x1F, 0x00],
    'I': [0x11, 0x1F, 0x11, 0x00, 0x00],
    'J': [0x08, 0x10, 0x10, 0x0F, 0x00],
    'K': [0x1F, 0x04, 0x0A, 0x11, 0x00],
    'L': [0x1F, 0x10, 0x10, 0x10, 0x00],
    'M': [0x1F, 0x02, 0x04, 0x02, 0x1F],
    'N': [0x1F, 0x02, 0x04, 0x1F, 0x00],
    'O': [0x0E, 0x11, 0x11, 0x0E, 0x00],
    'P': [0x1F, 0x05, 0x05, 0x02, 0x00],
    'Q': [0x0E, 0x11, 0x19, 0x1E, 0x00],
    'R': [0x1F, 0x05, 0x0D, 0x12, 0x00],
    'S': [0x12, 0x15, 0x15, 0x09, 0x00],
    'T': [0x01, 0x1F, 0x01, 0x01, 0x00],
    'U': [0x0F, 0x10, 0x10, 0x0F, 0x00],
    'V': [0x07, 0x08, 0x10, 0x08, 0x07],
    'W': [0x1F, 0x08, 0x04, 0x08, 0x1F],
    'X': [0x11, 0x0A, 0x04, 0x0A, 0x11],
    'Y': [0x01, 0x02, 0x1C, 0x02, 0x01],
    'Z': [0x19, 0x15, 0x13, 0x11, 0x00],

    '0': [0x0E, 0x11, 0x15, 0x11, 0x0E],
    '1': [0x00, 0x12, 0x1F, 0x10, 0x00],
    '2': [0x12, 0x19, 0x15, 0x12, 0x00],
    '3': [0x0A, 0x11, 0x15, 0x0F, 0x00],
    '4': [0x0C, 0x14, 0x14, 0x1F, 0x04],
    '5': [0x17, 0x15, 0x15, 0x09, 0x00],
    '6': [0x0E, 0x15, 0x15, 0x08, 0x00],
    '7': [0x01, 0x01, 0x1D, 0x03, 0x00],
    '8': [0x0A, 0x15, 0x15, 0x0A, 0x00],
    '9': [0x02, 0x15, 0x15, 0x0E, 0x00],

    ' ': [0x00, 0x00, 0x00, 0x00, 0x00],
    '.': [0x00, 0x10, 0x00, 0x00, 0x00],
    ':': [0x00, 0x0A, 0x00, 0x00, 0x00],
    '-': [0x04, 0x04, 0x04, 0x00, 0x00],
    '/': [0x10, 0x08, 0x04, 0x02, 0x01],
    '!': [0x00, 0x00, 0x1D, 0x00, 0x00],
    '?': [0x00, 0x12, 0x15, 0x00, 0x00],
    ',': [0x00, 0x00, 0x10, 0x08, 0x00],
    '_': [0x00, 0x00, 0x00, 0x00, 0x1F],
    '(': [0x00, 0x00, 0x1C, 0x02, 0x00],
    ')': [0x00, 0x02, 0x1C, 0x00, 0x00],
    '+': [0x04, 0x04, 0x1F, 0x04, 0x04],
    '=': [0x00, 0x00, 0x1F, 0x00, 0x00],
    '<': [0x02, 0x04, 0x08, 0x04, 0x02],
    '>': [0x08, 0x04, 0x02, 0x04, 0x08],
    '[': [0x00, 0x1F, 0x11, 0x00, 0x00],
    ']': [0x00, 0x11, 0x1F, 0x00, 0x00],
    '{': [0x00, 0x1F, 0x11, 0x00, 0x00],
    '}': [0x00, 0x11, 0x1F, 0x00, 0x00],
    '\"': [0x00, 0x1A, 0x00, 0x00, 0x00],
    '\'': [0x00, 0x1A, 0x00, 0x00, 0x00],
    '#': [0x14, 0x1F, 0x14, 0x1F, 0x14],
    '$': [0x04, 0x0E, 0x15, 0x0A, 0x00],
    '%': [0x11, 0x12, 0x04, 0x08, 0x00],
    '&': [0x0A, 0x15, 0x12, 0x1D, 0x00],
    '@': [0x0E, 0x11, 0x15, 0x13, 0x00],
}

def draw_pixel(eye, x, y, color):
    if not (0 <= x < 160 and 0 <= y < 160):
        return  # Skip pixels outside display bounds
    eye.set_window(x, y, x, y)
    hi = (color >> 8) & 0xFF
    lo = color & 0xFF
    eye.write_data(bytes([hi, lo]))


def draw_char(eye, x, y, char, color, scale=1):
    char = char.upper()
    if char not in FONT_5X7:
        char = ' '
    pixels = FONT_5X7[char]
    for col, byte in enumerate(pixels):
        for row in range(7):
            if byte & (1 << row):
                for dx in range(scale):
                    for dy in range(scale):
                        draw_pixel(eye, x + col * scale + dx, y + row * scale + dy, color)

def draw_text(eye, x, y, text, color, scale=1, spacing=1):
    for i, char in enumerate(text):
        draw_char(eye, x + i * (5 * scale + spacing), y, char, color, scale)
